<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metal Radio Player</title>
<style>
  body {
      margin: 0;
      min-height: 100vh;
      background: #0a0a0a;
      color: #eee;
      font-family: Arial, sans-serif;
  }

  #main {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
  }

  #now-playing {
      display: flex;
      gap: 20px;
      align-items: center;
      background: #000;
      border: 1px solid #330000;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      flex-wrap: wrap;
  }

  #now-art {
      width: 320px;
      height: 320px;
      border-radius: 8px;
      object-fit: cover;
      box-shadow: 0 0 30px rgba(255,0,0,0.35);
  }

  #now-title { font-size: 1.5em; font-weight: bold; }
  #now-channel { opacity: 0.7; }

  #player-ui {
      background: #000;
      border: 1px solid #330000;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 15px;
  }

  #player-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
  }

  #playPause {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      border: 1px solid #660000;
      background: linear-gradient(180deg, #ff1a1a, #990000);
      color: #fff;
      font-size: 18px;
      cursor: pointer;
  }

  #progress-container {
      flex: 1;
      height: 12px;
      background: #111;
      border-radius: 10px;
      position: relative;
      cursor: pointer;
      overflow: hidden;
      min-width: 200px;
  }

  #progress {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff1a1a, #990000);
      box-shadow: 0 0 15px rgba(255,0,0,0.6);
  }

  #playhead {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #ff1a1a;
      box-shadow: 0 0 12px rgba(255,0,0,0.9);
      pointer-events: none;
  }

  #volume { width: 90px; accent-color: #ff1a1a; cursor: pointer; }

  #time {
      display: flex;
      justify-content: space-between;
      font-size: 0.85em;
      opacity: 0.75;
      margin-top: 6px;
  }

  .controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
  }

  .btn {
      padding: 10px 20px;
      border-radius: 6px;
      border: 1px solid #660000;
      cursor: pointer;
      font-weight: bold;
      background: linear-gradient(180deg, #ff1a1a, #990000);
      color: #fff;
  }

  #channels-panel {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 15px;
      overflow-y: auto;
  }

  .channel-btn {
      background: #111;
      border: 1px solid #330000;
      border-radius: 10px;
      padding: 20px;
      font-size: 1.1em;
      font-weight: bold;
      color: #fff;
      cursor: pointer;
  }

  .channel-btn.active {
      background: linear-gradient(180deg, #ff1a1a, #990000);
      box-shadow: 0 0 20px rgba(255,0,0,0.4);
  }

  @media (max-width: 600px) {
      #now-art { width: 100%; height: auto; }
      #progress-container { min-width: 100px; }
  }
</style>
</head>
<body>

<div id="main">
    <div id="now-playing">
        <img id="now-art" src="thumbs/Default.gif">
        <div>
            <div id="now-title">—</div>
            <div id="now-channel">—</div>
        </div>
    </div>

    <div id="player-ui">
        <div id="player-controls">
            <button id="playPause">▶</button>
            <div id="progress-container">
                <div id="progress"></div>
                <div id="playhead"></div>
            </div>
            <input id="volume" type="range" min="0" max="1" step="0.01" value="1">
        </div>

        <div id="time">
            <span id="current">0:00</span>
            <span id="duration">0:00</span>
        </div>
    </div>

    <audio id="audio"></audio>

    <div class="controls">
        <button class="btn" id="prevBtn">⏮ Prev</button>
        <button class="btn" id="nextBtn">⏭ Next</button>
    </div>

    <div id="channels-panel"></div>
</div>

<script>
const FALLBACK_THUMB = 'thumbs/Default.gif';

const channels = {
    ThrashMetal: {
        name: 'Thrash Metal',
        tracks: [
            { file: 'mp3/thrashmetal/Exodus - Fabulous Disaster.mp3', title: 'Exodus - Fabulous Disaster', thumb: 'thumbs/thrashmetal/Exodus - Fabulous Disaster.jpg' },
            { file: 'mp3/thrashmetal/Anthrax - Caught In A Mosh.mp3', title: 'Anthrax - Caught In A Mosh', thumb: 'thumbs/thrashmetal/Anthrax - Caught In A Mosh.jpg' },
            { file: 'mp3/thrashmetal/Evildead - Gone Shooting.mp3', title: 'Evildead - Gone Shooting', thumb: 'thumbs/thrashmetal/Evildead - Gone Shooting.jpg' },
            { file: 'mp3/thrashmetal/Mortal Sin - Voyage of the Disturbed.mp3', title: 'Mortal Sin - Voyage of the Disturbed', thumb: 'thumbs/thrashmetal/Mortal Sin - Voyage of the Disturbed.jpg' },
            { file: 'mp3/thrashmetal/Lich King - We Came To Conquer.mp3', title: 'Lich King - We Came To Conquer', thumb: 'thumbs/thrashmetal/Lich King - We Came To Conquer.jpg' },
            { file: 'mp3/thrashmetal/Artillery - Terror Squad.mp3', title: 'Artillery - Terror Squad', thumb: 'thumbs/thrashmetal/Artillery - Terror Squad.jpg' },
            { file: 'mp3/thrashmetal/Lost Society - KILL Those Who Oppose Me.mp3', title: 'Lost Society - KILL Those Who Oppose Me', thumb: 'thumbs/thrashmetal/Lost Society - KILL Those Who Oppose Me.jpg' },
            { file: 'mp3/thrashmetal/Droys - Cannibal New Year.mp3', title: 'Droys - Cannibal New Year', thumb: 'thumbs/thrashmetal/Droys - Cannibal New Year.jpg' },
            { file: 'mp3/thrashmetal/Sodom - Agent Orange.mp3', title: 'Sodom - Agent Orange', thumb: 'thumbs/thrashmetal/Sodom - Agent Orange.jpg' }
        ]
    },
    Rock: {
        name: 'Rock',
        tracks: [
            { file: 'mp3/rock/ACDC-HighVoltage.mp3', title: 'AC DC - High Voltage', thumb: 'thumbs/rock/ACDC-HighVoltage.jpg' },
            { file: 'mp3/rock/ACDC-TNT.mp3', title: 'AC DC - T.N.T', thumb: 'thumbs/rock/ACDC-TNT.jpg' }
        ]
    }
};

let currentChannel = 'ThrashMetal';
let playlist = [];
let bag = [];
let history = [];

const audio = document.getElementById('audio');
const playPause = document.getElementById('playPause');
const volume = document.getElementById('volume');

function refillBag() {
    bag = playlist.map((_, i) => i).sort(() => Math.random() - 0.5);
}

function nextIndex() {
    if (!bag.length) refillBag();
    const i = bag.shift();
    history.push(i);
    return i;
}

function prevIndex() {
    if (history.length > 1) {
        history.pop();
        return history[history.length - 1];
    }
    return history[0];
}

function loadTrack(i) {
    const t = playlist[i];
    audio.src = t.file;
    document.getElementById('now-art').src = t.thumb || FALLBACK_THUMB;
    document.getElementById('now-title').textContent = t.title;
    document.getElementById('now-channel').textContent = channels[currentChannel].name;
}

function playTrack(i) {
    loadTrack(i);
    audio.play().then(() => {
        playPause.textContent = '⏸';
    }).catch(() => {
        playPause.textContent = '▶';
    });
}

function switchChannel(ch) {
    currentChannel = ch;
    playlist = channels[ch].tracks;
    history = [];
    refillBag();
    renderChannels();
    loadTrack(nextIndex());
}

function renderChannels() {
    const p = document.getElementById('channels-panel');
    p.innerHTML = '';
    Object.keys(channels).forEach(ch => {
        const b = document.createElement('button');
        b.className = 'channel-btn' + (ch === currentChannel ? ' active' : '');
        b.textContent = channels[ch].name;
        b.onclick = () => switchChannel(ch);
        p.appendChild(b);
    });
}

playPause.onclick = () => {
    if (audio.paused) {
        audio.play().catch(() => {});
        playPause.textContent = '⏸';
    } else {
        audio.pause();
        playPause.textContent = '▶';
    }
};

volume.oninput = () => audio.volume = volume.value;

audio.addEventListener('ended', () => playTrack(nextIndex()));
document.getElementById('nextBtn').onclick = () => playTrack(nextIndex());
document.getElementById('prevBtn').onclick = () => playTrack(prevIndex());

const progress = document.getElementById('progress');
const playhead = document.getElementById('playhead');
const container = document.getElementById('progress-container');
const cur = document.getElementById('current');
const dur = document.getElementById('duration');

audio.addEventListener('timeupdate', () => {
    const p = (audio.currentTime / audio.duration) * 100 || 0;
    progress.style.width = p + '%';
    playhead.style.left = p + '%';
    cur.textContent = fmt(audio.currentTime);
});

audio.addEventListener('loadedmetadata', () => {
    dur.textContent = fmt(audio.duration);
});

function seek(e) {
    const r = container.getBoundingClientRect();
    const x = (e.touches ? e.touches[0].clientX : e.clientX) - r.left;
    audio.currentTime = (x / r.width) * audio.duration;
}

container.addEventListener('click', seek);
container.addEventListener('touchstart', seek);

function fmt(t) {
    const m = Math.floor(t / 60);
    const s = Math.floor(t % 60).toString().padStart(2,'0');
    return `${m}:${s}`;
}

renderChannels();
switchChannel(currentChannel);

/* ===== MEDIA SESSION (Lockscreen + Notification Controls) ===== */
if ('mediaSession' in navigator) {

    function updateMediaSession(track) {
        navigator.mediaSession.metadata = new MediaMetadata({
            title: track.title,
            artist: channels[currentChannel].name,
            artwork: [
                { src: track.thumb || FALLBACK_THUMB, sizes: '512x512', type: 'image/jpeg' }
            ]
        });
    }

    function updatePlaybackState() {
        navigator.mediaSession.playbackState = audio.paused ? 'paused' : 'playing';
    }

    function updatePositionState() {
        if ('setPositionState' in navigator.mediaSession) {
            navigator.mediaSession.setPositionState({
                duration: audio.duration || 0,
                playbackRate: audio.playbackRate || 1,
                position: audio.currentTime || 0
            });
        }
    }

    navigator.mediaSession.setActionHandler('play', () => {
        audio.play();
        playPause.textContent = '⏸';
        updatePlaybackState();
    });

    navigator.mediaSession.setActionHandler('pause', () => {
        audio.pause();
        playPause.textContent = '▶';
        updatePlaybackState();
    });

    navigator.mediaSession.setActionHandler('previoustrack', () => {
        playTrack(prevIndex());
    });

    navigator.mediaSession.setActionHandler('nexttrack', () => {
        playTrack(nextIndex());
    });

    const origPlayTrack = playTrack;
    playTrack = (i) => {
        origPlayTrack(i);
        updateMediaSession(playlist[i]);
        updatePlaybackState();
    };

    audio.addEventListener('timeupdate', updatePositionState);
    audio.addEventListener('loadedmetadata', updatePositionState);
}
</script>

</body>
</html>
